doctype html
html
include ../head
body
    header.navbar.navbar-dark.sticky-top.bg-dark.flex-md-nowrap.p-0.shadow
      a.navbar-brand.col-md-3.col-lg-2.me-0.px-3(href='/') Cuyana Medical
      button.navbar-toggler.position-absolute.d-md-none.collapsed(type='button' data-bs-toggle='collapse' data-bs-target='#sidebarMenu' aria-controls='sidebarMenu' aria-expanded='false' aria-label='Toggle navigation')
        span.navbar-toggler-icon
     
      .navbar-nav
        .nav-item.text-nowrap
          if(user && persona)
            a.nav-link.pl-5 Bienvenido  #{persona.nombre} #{persona.apellido}.  Usuario: #{user.usuario} 
              if(user.RoleId==1) 
                 | Rol: Administrador
              if(user.RoleId==2)
                 | Rol: Admision
              if(user.RoleId==3)
                 | Rol: Paciente
          else  
            a.nav-link.pl-5 Bienvenido Usuario: #{user.usuario} 
      .navbar-nav      
        .nav-item.text-nowrap
          a.nav-link.px-3(href='/logout') Cerrar sesion
    .container-fluid
      .row
        nav#sidebarMenu.col-md-3.col-lg-2.d-md-block.bg-light.sidebar.collapse
          .position-sticky.pt-3
            ul.nav.flex-column
              li.nav-item
                a.nav-link(aria-current='page' href='/clinica/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home" aria-hidden="true")
                    path(d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z")
                    polyline(points="9 22 9 12 15 12 15 22")
                  |                 Clinicas
              li.nav-item
                a.nav-link(href='/medico/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user" aria-hidden="true")
                    path(d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2")
                    circle(cx="12" cy="7" r="4")

                  |                 Medicos
              li.nav-item
                a.nav-link(href='/procedimiento/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-activity" aria-hidden="true")
                    polyline(points="22 12 18 12 15 21 9 3 6 12 2 12")
      
                  |                 Procedimientos
              li.nav-item
                a.nav-link(href='/especialidad/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-square" aria-hidden="true")
                    rect(x="3" y="3" width="18" height="18" rx="2" ry="2")
                    line(x1="12" y1="8" x2="12" y2="16")
                    line(x1="8" y1="12" x2="16" y2="12")
                  |    Especialidades
              li.nav-item
                a.nav-link(href='/persona/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users" aria-hidden="true")
                    path(d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2")
                    circle( cx="9" cy="7" r="4")
                    path(d="M23 21v-2a4 4 0 0 0-3-3.87")
                    path(d="M16 3.13a4 4 0 0 1 0 7.75")
                 
                  |                 Personas
              
              li.nav-item
                a.nav-link(href='/agenda/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-book" aria-hidden="true")
                    path(d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20")
                    path(d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z")
                    
                  |                 Agenda
              li.nav-item
                if(user.RoleId==2)
                  a.nav-link(href='/turno/secretarioTurnos') 
                     svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-book-open" aria-hidden="true")
                      path(d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z")
                      path(d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z")            
                     |              Turnos
                if(user.RoleId==3)
                  a.nav-link(href='/turno/misTurnos')
                    svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-book-open" aria-hidden="true")
                      path(d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z")
                      path(d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z")            
                    |                 Mis turnos   
          
        main.col-md-9.ms-sm-auto.col-lg-10.px-md-4
          .d-flex.justify-content-between.flex-wrap.flex-md-nowrap.align-items-center.pt-3.pb-2.mb-3.border-bottom
            h1.h2 Turnos
            .btn-toolbar.mb-2.mb-md-0
              .btn-group.me-2
                a.btn.btn-sm.btn-outline-secondary(type='button' href='/turno/misTurnos') Volver
               
          
          
              
          div(class="container")
            div(class="form-group")
              div(class="row")
                div( class="card mb-3")
                  div( class="card-body")
                    
                    h4(class="text-center") Reservar turno
                    form(action="/turno/buscarTurno", method="post")
                          .form-group
                            div(class="mb-3" id='buscarPor')                             
                              h5 Buscar turno por
                            div(class="mb-3 ")       
                              div(class="form-check form-check-inline")
                                input(class="form-check-input" type="radio" name="radioBtn" id="rb1" value="clinica")
                                label(class="form-check-label fw-bold" for="clinica") Clinica
                            
                              //- div(class="form-check form-check-inline")
                              //-   input(class="form-check-input" type="radio" name="radioBtn" id="rb2" value="option2")
                              //-   label(class="form-check-label  fw-bold" for="medico") Medico
                              
                              div(class="form-check form-check-inline")
                                input(class="form-check-input" type="radio" name="radioBtn" id="rb3" value="procedimiento")
                                label(class="form-check-label  fw-bold" for="procedimiento") Procedimiento

                              div(class="form-check form-check-inline")
                                input(class="form-check-input" type="radio" name="radioBtn" id="rb4" value="especialidad")
                                label(class="form-check-label  fw-bold" for="especialidad") Especialidad
                            
                            
                            
                            
                          .group-clinica(style="display: none") 
                            div(class="mb-3 ")
                              input(hidden name='userId' value=user.id)
                              label(for="clinica" class="col col-form-label") Clinica
                              div(class="col-sm")
                                select#clinica(name="clinica" class="form-control")
                                  option(value=null disabled selected required) Seleccione clinica 
                          .group-tipo(style="display: none")  
                            div(class="mb-3" id="tipoAgenda")   
                              label(for="tipo" class="col col-form-label") Tipo de agenda
                              div(class="col-sm" id="tipoAgendaSel" )
                                select#tipo(name="tipo" class="form-control" required)
                                  option(value=null disabled selected required) Seleccione...
                                  option(value="Medico") Medico
                                  option(value="Procedimiento") Procedimiento
                          .group-medico(style="display: none")  
                            div(class="mb-3 ")   
                              label(for="especialidad" class="col col-form-label") Especialidad
                              div(class="col-sm")
                                select#especialidad(name="especialidad" class="form-control" required)
                                  option(value=null disabled selected) Seleccione...

                            div(class="mb-3 ")   
                              label(for="medico" class="col col-form-label") Medico
                              div(class="col-sm")
                                select#medico(name="medico" class="form-control" required)
                                  option(value=null disabled selected) Seleccione...
                          .group-procedimiento(style="display: none")  
                            div(class="mb-3 ")   
                              label(for="procedimiento" class="col col-form-label") Procedimiento
                              div(class="col-sm")
                                select#procedimiento(name="procedimiento" class="form-control" required)
                                  option(value=null disabled selected) Seleccione...
                        
                          .form-group
                            div(class="mb-3 ") 

                          .buscar(style="display: none")   
                            .form-group
                              div(class="mt-3 ") 
                                  button.btn.btn-success.btn-block( id="buscar" type='submit' disabled)  Buscar
                          

include ../footer 
script.
        $("#rb1").click(function(){
          $(".group-clinica").css("display", "block")   
          $(".group-tipo").css("display", "block")   
          $(".buscar").css("display", "block")   
          $(".group-procedimiento").css("display", "none")
           $(".group-especialidad").css("display", "none")

        });
        $("#rb2").click(function(){
          $(".group-clinica").css("display", "none")    
        });
        $("#rb3").click(function(){
          $(".group-clinica").css("display", "none")    
          $(".buscar").css("display", "block")          
          $(".group-tipo").css("display", "none")   
          $(".group-procedimiento").css("display", "block")
          $(".group-medico").css("display", "none")  
           $(".group-especialidad").css("display", "none")  
        });

         $("#rb4").click(function(){
            $(".group-tipo").css("display", "none")   
            $(".group-clinica").css("display", "none")   
            $(".group-medico").css("display", "block")  
            $(".buscar").css("display", "block")  
        });

          $(document).ready(function(){
            console.log($("#clinica").val())

          if($("#clinica").val() != null && $("#especialidad").val() != null && $("#procedimiento").val() != null ){
            $("#buscar").prop('disabled', false); 
          }          
          });

        $("#medico").change(function(){
             if($("#clinica").val() != null || $("#especialidad").val() != null  &&  $("#medico").val()){
               $("#buscar").prop('disabled', false); 
             }
         });
         $("#procedimiento").change(function(){
             if($("#clinica").val() != null || $("#procedimiento").val() != null){
               $("#buscar").prop('disabled', false); 
             }
          });

        $("#tipo").change(function(){
            if($("#tipo").val() == "Medico"){
                $(".group-medico").css("display", "block")
            }else{
                $(".group-medico").css("display", "none")
                $("#especialidad").prop('selectedIndex', 0)
                $("#medico").prop('selectedIndex', 0)
            }
            
            if($("#tipo").val() == "Procedimiento"){
                $(".group-procedimiento").css("display", "block")
            }else{
                $(".group-procedimiento").css("display", "none")
                $("#procedimiento").prop('selectedIndex', 0)
            }
        });
      
        $(document).ready(function() {
            $.ajax({
                url: `http://localhost:3000/especialidad/todas`,
                type: 'GET',
                success: function(respuesta) {
                    respuesta.forEach(e=>{
                        console.log(e.nombre)
                        document.getElementById('especialidad').innerHTML += `<option value=${e.id}>${e.nombre}</option>`;
                    });
                },
                error: function() {
                    console.error("No es posible completar la operación");
                }
            });
            $.ajax({
                url: `http://localhost:3000/procedimiento/todas`,
                type: 'GET',
                success: function(respuesta) {
                  console.log(respuesta)
                    respuesta.forEach(e=>{
                        console.log(e.nombre)
                        document.getElementById('procedimiento').innerHTML += `<option value=${e.id}>${e.nombre}</option>`;
                    });
                },
                error: function() {
                    console.error("No es posible completar la operación");
                }
            });
            $.ajax({
                url: `http://localhost:3000/agenda/clinicaTodas`,
                type: 'GET',
                dataType:'json',
                
                success: function(data) {
                  data
                    console.log(data)
                    data.forEach(e=>{
                        console.log("dentro de clinicatodas" + e.nombre)
                        document.getElementById('clinica').innerHTML += `<option value=${e.id}>${e.nombre}</option>`;
                    });
                },
                error: function() {
                    console.error("No es posible completar la operación");
                }
            });
        });

        $("#especialidad").click(function() {
            document.getElementById('medico').innerHTML = '';
            document.getElementById('medico').innerHTML = `<option value="Null" required disabled}>Seleccione</option>`;
            $.ajax({
                url: `http://localhost:3000/medico/esp/${$("#especialidad").val()}`,
                type: 'GET',
                success: function(respuesta) {
                   console.log(respuesta);
                  console.log(Object.keys(respuesta).length);
                  if (Object.keys(respuesta).length== 0){
                    document.getElementById('medico').innerHTML += `<option value=null disabled>No hay medicos agregados a la especialidad seleccionada</option>`;
                  }
                  else { respuesta.forEach(e=>{
                        console.log(e.nombre)
                        document.getElementById('medico').innerHTML += `<option value=${e.id}>${e.Persona.nombre} ${e.Persona.apellido}</option>`;
                    });}
                  
                },
                error: function() {
                    console.error("No es posible completar la operación");
                }
            });
        });

        $("#clinica").click(function() {
            document.getElementById('medico').innerHTML = '';
            document.getElementById('medico').innerHTML = `<option value="Null" required disabled}>Seleccione</option>`;
            $.ajax({
                url: `http://localhost:3000/medico/esp/${$("#especialidad").val()}`,
                type: 'GET',
                success: function(respuesta) {
                   console.log(respuesta);
                  console.log(Object.keys(respuesta).length);
                  if (Object.keys(respuesta).length== 0){
                    document.getElementById('medico').innerHTML += `<option value=null disabled>No hay medicos agregados a la especialidad seleccionada</option>`;
                  }
                  else { respuesta.forEach(e=>{
                        console.log(e.nombre)
                        document.getElementById('medico').innerHTML += `<option value=${e.id}>${e.Persona.nombre} ${e.Persona.apellido}</option>`;
                    });}
                  
                },
                error: function() {
                    console.error("No es posible completar la operación");
                }
            });
        });

         function buscar(e){
           
         }

        //- $("#rb1").click(function(){
        //-   $.ajax({
        //-         url: `http://localhost:3000/agenda/clinicaTodas`,
        //-         type: 'GET',
        //-         success: function(respuesta) {
        //-             console.log(respuesta)
        //-             respuesta.forEach(e=>{
        //-                 console.log("dentro de clinicatodas" + e.nombre)
        //-                 document.getElementById('clinica').innerHTML += `<option value=${e.id}>${e.nombre}</option>`;
        //-             });
        //-         },
        //-         error: function() {
        //-             console.error("No es posible completar la operación");
        //-         }
        //-     });
        //- })