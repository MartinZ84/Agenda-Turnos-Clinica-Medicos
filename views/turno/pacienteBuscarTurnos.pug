doctype html
html
include ../head

body
    header.navbar.navbar-dark.sticky-top.bg-dark.flex-md-nowrap.p-0.shadow
      a.navbar-brand.col-md-3.col-lg-2.me-0.px-3(href='/') Cuyana Medical
      button.navbar-toggler.position-absolute.d-md-none.collapsed(type='button' data-bs-toggle='collapse' data-bs-target='#sidebarMenu' aria-controls='sidebarMenu' aria-expanded='false' aria-label='Toggle navigation')
        span.navbar-toggler-icon
     
      .navbar-nav
        .nav-item.text-nowrap
          if(user && persona)
            a.nav-link.pl-5 Bienvenido  #{persona.nombre} #{persona.apellido}.  Usuario: #{user.usuario} 
              if(user.RoleId==1) 
                 | Rol: Administrador
              if(user.RoleId==2)
                 | Rol: Admision
              if(user.RoleId==3)
                 | Rol: Paciente
          else  
            a.nav-link.pl-5 Bienvenido Usuario: #{user.usuario} 
      .navbar-nav      
        .nav-item.text-nowrap
          a.nav-link.px-3(href='/logout') Cerrar sesion
    .container-fluid
      .row
        nav#sidebarMenu.col-md-3.col-lg-2.d-md-block.bg-light.sidebar.collapse
          .position-sticky.pt-3
            ul.nav.flex-column
              li.nav-item
                a.nav-link(aria-current='page' href='/clinica/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home" aria-hidden="true")
                    path(d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z")
                    polyline(points="9 22 9 12 15 12 15 22")
                  |                 Clínicas
              li.nav-item
                a.nav-link(href='/medico/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user" aria-hidden="true")
                    path(d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2")
                    circle(cx="12" cy="7" r="4")

                  |                 Médicos
              li.nav-item
                a.nav-link(href='/procedimiento/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-activity" aria-hidden="true")
                    polyline(points="22 12 18 12 15 21 9 3 6 12 2 12")
      
                  |                 Procedimientos
              li.nav-item
                a.nav-link(href='/especialidad/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-square" aria-hidden="true")
                    rect(x="3" y="3" width="18" height="18" rx="2" ry="2")
                    line(x1="12" y1="8" x2="12" y2="16")
                    line(x1="8" y1="12" x2="16" y2="12")
                  |    Especialidades
              li.nav-item
                a.nav-link(href='/persona/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users" aria-hidden="true")
                    path(d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2")
                    circle( cx="9" cy="7" r="4")
                    path(d="M23 21v-2a4 4 0 0 0-3-3.87")
                    path(d="M16 3.13a4 4 0 0 1 0 7.75")
                 
                  |                 Personas
             
              li.nav-item
                a.nav-link(href='/agenda/')
                  svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-book" aria-hidden="true")
                    path(d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20")
                    path(d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z")
                    
                  |                 Agenda
              li.nav-item
                if(user.RoleId==2)
                  a.nav-link(href='/turno/secretarioTurnos') 
                     svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-book-open" aria-hidden="true")
                      path(d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z")
                      path(d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z")            
                     |              Turnos
                if(user.RoleId==3)
                  a.nav-link(href='/turno/misTurnos')
                    svg(xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-book-open" aria-hidden="true")
                      path(d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z")
                      path(d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z")            
                    |                 Mis turnos   
          
        main.col-md-9.ms-sm-auto.col-lg-10.px-md-4
          .d-flex.justify-content-between.flex-wrap.flex-md-nowrap.align-items-center.pt-3.pb-2.mb-3.border-bottom
            h1.h2 Turnos
            .btn-toolbar.mb-2.mb-md-0
              .btn-group.me-2
                a.btn.btn-sm.btn-outline-secondary(type='button' href='/turno/buscarAgenda') Atras
               
                //- button.btn.btn-sm.btn-outline-secondary(type='button') Export
              //- button.btn.btn-sm.btn-outline-secondary.dropdown-toggle(type='button')
              //-   span(data-feather='calendar')
              //-   |               This week
          
          if(clinica)
            h4.text-center.text-primary.mt-3 Turnos disponibles en Clinica #{clinica.nombre} 
          else 
              h4.text-center.text-primary.mt-3 Turnos disponibles 
          if(procedimiento)    
              h5.text-center.text-danger.mt-3 Procedimiento: "#{procedimiento.nombre}"
          //- if(turnos)    
          //-     if (procedimiento)
          //-       h5.text-center.text-danger.mt-3 Procedimiento: "#{procedimiento.nombre}"

          //-      h5.text-center.text-danger.mt-3 Procedimiento: "#{turnos[0].Calendario.Agenda.Procedimiento.nombre}"
          //- else
          //-    h5.text-center.text-danger.mt-3 Procedimiento: "#{procedimiento.nombre}"
          if (medico)
            h5.text-center.text-danger.mt-3 Medico: "#{medico[0].Persona.nombre} #{medico[0].Persona.apellido} "
            h5.text-center.text-danger.mt-3 Especialidad: "#{medico[0].Especialidad.nombre}"
          div(class="container-xxl")
            div(class="row")
            div(class="col-lg-12")
                div(class="table-responsive")              
                  //- h2(class="text-center mt-3") Clinicas       

                  table(id="tablaTurnos_paciente" style="width: 100%" class="table table-striped table-bordered table-condensed")
                    thead(id="" class="text-center")  
                      tr
                        th Numero
                        th Agenda
                        th Clinica 
                        //- th(hidden)  Procedimiento                      
                        //- th Medico/Procedimiento
                        th Fecha turno        
                        th Hora turno
                        th Estado 
                        th Comentario
                        //- th Fecha creación            
                        //- th Fecha actualizacion     
                        th Reservar           
                        //- th Agregar dias de atencion a la agenda                     
                    tbody(id='tbTurnos' class="text-center")
                      if(turnos)
                        each val in turnos
                          tr
                            td= val.id
                            td= val.Calendario.Agenda.nombre
                            td= val.Calendario.Agenda.Clinica.nombre    
                            td(data-order=moment(val.Calendario.fecha).format('YY/MM/DD'))= moment(val.Calendario.fecha).format('DD/MM/YYYY') 
                           
                            td= val.hora_turno
                            td= val.Estado_turno.descripcion
                            td= val.comentario
                            td
                              a(href=`/turno/confirmarTurno/${val.id}` class="btn btn-danger") Reservar
                           
     
  
script(src="//cdn.jsdelivr.net/npm/sweetalert2@11") 
if(alert)
  script.
    Swal.fire({
    title: '#{alertTitle}',       
    text: '#{alertMessage}',
    //- text: 'ahhhhhhh',
    icon: '#{alertIcon}',
    showConfirmButton:  '#{showConfirmButton}',
    timer: '#{timer}'
    }).then(()=>{
        window.location = '/#{ruta}'
    })
script(src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous")    
script
  include ./../../public/javascripts/modal_turno.js    
include ../footer                           


    script.
        $(document).ready( function () {
            $('#myTable').DataTable();
        });

        function reservar(e){
            var id = $(e).parents("tr").find("td")[0].innerHTML;
            $.ajax({
                type:"POST",
                url:"http://localhost:3000/turno/reservar",
                data:{id: id, fecha_reserva: Date()},
                success:function(datos){
                },
                error:function(){
                    alert("estud es un paciente riesgoso")
                }
            })
            if($("#riesgoso").val() >= 3){
                alert("Usted es un paciente riesgosa confirme su turno lo antes posible")
            }
            location.href = "http://localhost:3000/turno/misTurnos"
        }